<h1>Todo List</h1>

<input type="text">
<button>Add Todo</button>

<ul>
	<%@todos.each do |todo| %>
	<li data-todo-id="<%= todo.id %>">  <input type="checkbox" <%if todo.completed%>checked<%end%>>
	<%=todo.description%> 
	<span>&times;</span>
	</li>
	<% end %>
</ul>

<script type="text/javascript">
$('button').click(function(){
	var desc = $('input').val();
	// console.log(desc);

	data_hash = {
		"todo":{"description": desc}
	}

	var request = $.ajax({
		url: "/todos",
		type: "POST",
		data: data_hash,
		dataType: "json"
	});

	request.done(function(data){
		// console.log("DONE FUNCTION");
		$('ul').append("<li>" + data.description + " <span>&times;</span></li>")
		console.log(data);
	})

	request.fail(function(data){
		console.log("FAIL FUNCTION");
		$('h1').append("<p> There was an error saving your todo</p>")
	});
});

$('span').click(function(){
	var li = $(this).parent();
	var id = li.data("todo-id")

	var request = $.ajax({
		url: "/todos/"+id,
		type: "DELETE",
		dataType: "json"
	});

	request.done(function(data){
		li.remove();
	})
})


// $('.myCheckbox').prop('checked', true);
$("input:checkbox").click(function(){
	var li = $(this).parent();
	var id = li.data("todo-id");
	var checkbox_value = $(this).is(':checked');
	console.log(checkbox_value);

	data_hash = {
		"todo":{"completed":checkbox_value}
	}

	var request = $.ajax({
		url: "/todos/"+ id,
		type: "PATCH",
		data: data_hash,
		dataType: "json"
	});
	request.done(function(data){
		console.log(data)
	})
	// console.log(this.checked)
})
</script>